<!-- templates/registration/login.html -->
<!DOCTYPE html>
<html lang="en" class="h-full bg-gray-50">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Login — Social Automation Web</title>
  
  <!-- Tailwind CSS (via CDN) -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- Alpine.js -->
  <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
  
  <!-- Optional: Inter font -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Inter', sans-serif; }
  </style>
</head>
<body class="h-full">
  <div class="flex min-h-full flex-col justify-center px-6 py-12 lg:px-8">
    <div class="sm:mx-auto sm:w-full sm:max-w-sm">
      <h2 class="mt-6 text-center text-3xl font-bold tracking-tight text-gray-900">
        Sign in to your account
      </h2>
      <p class="mt-2 text-center text-sm text-gray-600">
        Social Automation Web
      </p>
    </div>

    <div class="mt-10 sm:mx-auto sm:w-full sm:max-w-sm">
      <form class="space-y-6" method="post">
        {% csrf_token %}

        <!-- Error Handling -->
        {% if form.non_field_errors %}
          <div 
            x-data="{ show: true }"
            x-show="show"
            class="rounded-md bg-red-50 p-4 mb-4"
          >
            <div class="flex">
              <div class="ml-3">
                <h3 class="text-sm font-medium text-red-800">Invalid credentials</h3>
                <div class="mt-2 text-sm text-red-700">
                  <ul class="list-disc pl-5 space-y-1">
                    {% for error in form.non_field_errors %}
                      <li>{{ error }}</li>
                    {% endfor %}
                  </ul>
                </div>
              </div>
              <div class="ml-auto">
                <button 
                  type="button" 
                  @click="show = false"
                  class="text-red-500 hover:text-red-700"
                >
                  &times;
                </button>
              </div>
            </div>
          </div>
        {% endif %}

        <!-- Username Field -->
        <div>
          <label for="{{ form.username.id_for_label }}" class="block text-sm font-medium text-gray-900">
            Username
          </label>
          <div class="mt-1">
            {{ form.username }}
            {% if form.username.errors %}
              <p class="mt-1 text-sm text-red-600">{{ form.username.errors|join:", " }}</p>
            {% endif %}
          </div>
        </div>

        <!-- Password Field with Toggle -->
        <div x-data="{ showPassword: false }">
          <div class="flex items-center justify-between">
            <label for="{{ form.password.id_for_label }}" class="block text-sm font-medium text-gray-900">
              Password
            </label>
            <!-- Optional: "Forgot password?" link -->
            <!-- <a href="#" class="text-sm font-semibold text-indigo-600 hover:text-indigo-500">Forgot password?</a> -->
          </div>
          <div class="mt-1 relative">
            {{ form.password }}
            <button
              type="button"
              @click="showPassword = !showPassword"
              class="absolute inset-y-0 right-0 pr-3 flex items-center text-sm text-gray-500 hover:text-gray-700"
            >
              <span x-show="!showPassword">Show</span>
              <span x-show="showPassword">Hide</span>
            </button>
          </div>
          {% if form.password.errors %}
            <p class="mt-1 text-sm text-red-600">{{ form.password.errors|join:", " }}</p>
          {% endif %}
        </div>

        <!-- Submit Button -->
        <div>
          <button
            type="submit"
            class="flex w-full justify-center rounded-md bg-indigo-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600"
          >
            Sign in
          </button>
        </div>
      </form>

      <!-- Optional: Already logged in message -->
      {% if user.is_authenticated %}
        <div class="mt-6 text-center text-sm text-gray-600">
          You're already logged in as <strong>{{ user.username }}</strong>.
          <a href="{% url 'admin:logout' %}" class="font-medium text-indigo-600 hover:text-indigo-500">Logout</a>
        </div>
      {% endif %}
    </div>
  </div>

  <!-- Inline script to make password input respect Alpine toggle -->
  <script>
    document.addEventListener('alpine:init', () => {
      Alpine.data('passwordToggle', () => ({
        showPassword: false,
        init() {
          const passwordInput = this.$el.querySelector('input[type="password"]');
          if (passwordInput) {
            // Replace Django's password input with one that respects Alpine binding
            const newInput = document.createElement('input');
            newInput.type = 'password';
            newInput.name = passwordInput.name;
            newInput.id = passwordInput.id;
            newInput.className = passwordInput.className;
            newInput.required = passwordInput.required;
            newInput.placeholder = passwordInput.placeholder || '••••••';
            
            passwordInput.replaceWith(newInput);
            this.passwordInput = newInput;
          }
        },
        toggle() {
          this.showPassword = !this.showPassword;
          if (this.passwordInput) {
            this.passwordInput.type = this.showPassword ? 'text' : 'password';
          }
        }
      }));
    });
  </script>
</body>
</html>